// Tire Pressure Monitoring System
// ****** Alarm.h
#ifndef ALARM_H
#define ALARM_H

#include "Sensor.h"

class Alarm {
public:
	Alarm();
	void check();
	bool isAlarmOn();
private:
	static const double LowPressureThreshold;
	static const double HighPressureThreshold;
	Sensor* sensor;
	bool alarmOn;
};

#endif /* ALARM_H */

// ****** Alarm.cpp
#include "Alarm.h"

void Alarm::check() {
	double psiPressureValue = sensor->popNextPressurePsiValue();

	if (psiPressureValue < LowPressureThreshold || HighPressureThreshold < psiPressureValue) {
		alarmOn = true;
	}
}

bool Alarm::isAlarmOn() {
	return alarmOn;
}

Alarm::Alarm() {
	sensor = new Sensor;
	alarmOn = false;
}

const double Alarm::LowPressureThreshold = 17;
const double Alarm::HighPressureThreshold = 21;

// ****** Sensor.h
#ifndef SENSOR_H
#define SENSOR_H

#include <random>

class Sensor {
public:
	Sensor();
	static const double OFFSET;
	double popNextPressurePsiValue();

private:
	static double samplePressure();
};

#endif /* SENSOR_H */

// ****** Sensor.cpp
#include "Sensor.h"

double Sensor::popNextPressurePsiValue() {
	double pressureTelemetryValue;
	pressureTelemetryValue = samplePressure();

	return OFFSET + pressureTelemetryValue;
}

double Sensor::samplePressure() {
	// placeholder implementation that simulate a real sensor in a real tire
	static std::default_random_engine engine;
	static std::uniform_real_distribution<double> uniform(0, 1);
	double pressureTelemetryValue = 6 * uniform(engine) * uniform(engine);
	return pressureTelemetryValue;
}

const double Sensor::OFFSET = 16;

Sensor::Sensor() {
}

// ****** Alarm.tests.cpp
#include "Alarm.h"
#include <gtest/gtest.h>

using namespace ::testing;

TEST(Hiker, Life_the_universe_and_everything)
{
    Alarm alarm;
    alarm.check();

    EXPECT_EQ(true, alarm.isAlarmOn());
}
